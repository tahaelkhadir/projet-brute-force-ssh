<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP Kali Linux - Hydra, John, fail2ban, SSH</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style2.css') }}">
</head>
<body>
    <nav>
        <ul>
            <li><a href="#preamble">Pr√©ambule</a></li>
            <li><a href="#setup">Configuration Initiale</a></li>
            <li><a href="#ex1">Exercice 1</a></li>
            <li><a href="#ex2">Exercice 2</a></li>
            <li><a href="#ex3">Exercice 3</a></li>
            <li><a href="#ex4">Exercice 4</a></li>
            <li><a href="#ex5">Exercice 5</a></li>
            <li><a href="#restore">Restauration</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1 class="glow">TP Kali Linux - Hydra, John, fail2ban, SSH</h1>

        <!-- Pr√©ambule -->
        <section id="preamble" class="card">
            <h2 class="glow">‚ö†Ô∏è Pr√©ambule & S√©curit√©</h2>
            <h3>ATTENTION : Ce TP est √† des fins √©ducatives uniquement !</h3>
            <ul>
                <li>‚úÖ Ex√©cuter uniquement sur une machine Kali Linux isol√©e</li>
                <li>‚úÖ Utiliser uniquement les mots de passe p√©dagogiques fournis</li>
                <li>‚ùå Ne JAMAIS attaquer de syst√®mes r√©els</li>
                <li>‚ùå Ne pas utiliser ces techniques en dehors d'un environnement de test contr√¥l√©</li>
            </ul>
        </section>

        <!-- Configuration Initiale -->
        <section id="setup" class="card">
            <h2 class="glow">üìã Configuration Initiale</h2>
            
            <h3>0.1 - Mettre √† jour le syst√®me</h3>
            <div class="terminal">
<pre>sudo apt update</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Liste des paquets disponibles pour mise √† jour</p>

            <h3>0.2 - Installer les outils n√©cessaires</h3>
            <div class="terminal">
<pre>sudo apt install -y openssh-server john hydra fail2ban</pre>
            </div>
            <p><strong>Description des outils :</strong></p>
            <ul>
                <li><code>openssh-server</code> : Serveur SSH</li>
                <li><code>john</code> : John the Ripper (casseur de mots de passe)</li>
                <li><code>hydra</code> : Outil de brute force</li>
                <li><code>fail2ban</code> : Protection contre les attaques par force brute</li>
            </ul>

            <h3>0.3 - Activer et d√©marrer SSH</h3>
            <div class="terminal">
<pre>sudo systemctl enable ssh
sudo systemctl start ssh</pre>
            </div>
            <p><strong>V√©rifier que SSH fonctionne :</strong></p>
            <div class="terminal">
<pre>sudo systemctl status ssh</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> "active (running)" en vert</p>

            <h3>0.4 - Cr√©er les utilisateurs de test</h3>
            <p><strong>Cr√©er l'utilisateur Alice :</strong></p>
            <div class="terminal">
<pre>sudo useradd -m -s /bin/bash alice
echo 'alice:password123' | sudo chpasswd</pre>
            </div>

            <p><strong>Cr√©er l'utilisateur Bob :</strong></p>
            <div class="terminal">
<pre>sudo useradd -m -s /bin/bash bob
echo 'bob:Summer2024!' | sudo chpasswd</pre>
            </div>

            <p><strong>Cr√©er l'utilisateur Charlie :</strong></p>
            <div class="terminal">
<pre>sudo useradd -m -s /bin/bash charlie
echo 'charlie:Y7$g9Q!kL2#v' | sudo chpasswd</pre>
            </div>

            <p><strong>V√©rifier la cr√©ation des utilisateurs :</strong></p>
            <div class="terminal">
<pre>cat /etc/passwd | grep -E "alice|bob|charlie"</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> 3 lignes affichant les informations des utilisateurs cr√©√©s</p>
        </section>

        <!-- Exercice 1 -->
        <section id="ex1" class="card">
            <h2 class="glow">üîç Exercice 1 - Pr√©parer les donn√©es pour John the Ripper</h2>
            
            <h3>1.1 - Extraire les hach√©s de mots de passe</h3>
            <div class="terminal">
<pre>sudo awk -F: '/alice|bob|charlie/{print $1":"$2}' /etc/shadow &gt; ~/hashes_course.txt</pre>
            </div>
            <p><strong>Explication :</strong> Cette commande extrait les noms d'utilisateurs et leurs mots de passe hach√©s depuis <code>/etc/shadow</code></p>

            <h3>1.2 - S√©curiser le fichier de hach√©s</h3>
            <div class="terminal">
<pre>sudo chmod 600 ~/hashes_course.txt</pre>
            </div>
            <p><strong>Explication :</strong> Seul le propri√©taire peut lire/√©crire le fichier (s√©curit√©)</p>

            <h3>1.3 - Cr√©er une wordlist p√©dagogique</h3>
            <div class="terminal">
<pre>cat &gt; ~/wordlist_course.txt &lt;&lt;'EOF'
password
password123
Summer2024!
summer
admin
123456
Y7$g9Q!kL2#v
letmein
qwerty
EOF</pre>
            </div>
            <p><strong>Explication :</strong> Cr√©ation d'une liste de mots de passe courants pour les tests</p>

            <h3>1.4 - V√©rifier les fichiers cr√©√©s</h3>
            <div class="terminal">
<pre>ls -l ~/hashes_course.txt ~/wordlist_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> 2 fichiers list√©s avec leurs permissions</p>

            <p><strong>Afficher le contenu des hach√©s :</strong></p>
            <div class="terminal">
<pre>head -n 20 ~/hashes_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Les lignes avec alice, bob et charlie suivies de leurs hach√©s SHA-512</p>

            <p><strong>Afficher la wordlist :</strong></p>
            <div class="terminal">
<pre>cat ~/wordlist_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Liste des 9 mots de passe</p>
        </section>

        <!-- Exercice 2 -->
        <section id="ex2" class="card">
            <h2 class="glow">üî® Exercice 2 - John the Ripper (cassage hors-ligne)</h2>
            
            <h3>2.1 - Casser les mots de passe avec la wordlist</h3>
            <div class="terminal">
<pre>john --wordlist=~/wordlist_course.txt ~/hashes_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> John devrait trouver les mots de passe d'Alice et Bob rapidement</p>
            <p><strong>Exemple de sortie :</strong></p>
            <div class="terminal">
<pre>password123      (alice)
Summer2024!      (bob)</pre>
            </div>

            <h3>2.2 - Utiliser les r√®gles de John (plus agressif)</h3>
            <div class="terminal">
<pre>john --format=crypt --wordlist=~/wordlist_course.txt --rules ~/hashes_course.txt
</pre>
            <p><strong>Explication :</strong> Les r√®gles appliquent des variations (majuscules, chiffres, caract√®res sp√©ciaux)</p>

            <h3>2.3 - Afficher tous les mots de passe trouv√©s</h3>
            <div class="terminal">
<pre>john --show ~/hashes_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong></p>
            <div class="terminal">
<pre>alice:password123
bob:Summer2024!
charlie:Y7$g9Q!kL2#v

3 password hashes cracked, 0 left</pre>
            </div>

            <h3>2.4 - Mesurer le temps de cassage</h3>
            <div class="terminal">
<pre>time john --wordlist=~/wordlist_course.txt ~/hashes_course.txt</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Affiche le temps r√©el, utilisateur et syst√®me pour le cassage</p>
        </section>

        <!-- Exercice 3 -->
        <section id="ex3" class="card">
            <h2 class="glow">üéØ Exercice 3 - Hydra attaque SSH</h2>
            
            <h3>3.1 - Lancer une attaque brute force contre Alice</h3>
            <div class="terminal">
<pre>hydra -l alice -P ~/wordlist_course.txt ssh://127.0.0.1 -t 4</pre>
            </div>
            <p><strong>Explication des param√®tres :</strong></p>
            <ul>
                <li><code>-l alice</code> : nom d'utilisateur cible</li>
                <li><code>-P ~/wordlist_course.txt</code> : fichier de mots de passe</li>
                <li><code>ssh://127.0.0.1</code> : protocole et cible (localhost)</li>
                <li><code>-t 4</code> : 4 threads parall√®les</li>
            </ul>
            <p><strong>R√©sultat attendu :</strong></p>
            <div class="terminal">
<pre>[22][ssh] host: 127.0.0.1   login: alice   password: password123</pre>
            </div>

            <h3>3.2 - Surveiller les logs SSH en temps r√©el</h3>
            <p><strong>Ouvrir un nouveau terminal et lancer :</strong></p>
            <div class="terminal">
<pre>sudo tail -f /var/log/auth.log</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Flux en direct des tentatives de connexion</p>

            <h3>3.3 - Analyser les √©checs de connexion</h3>
            <div class="terminal">
<pre>sudo grep 'Failed password' /var/log/auth.log | tail -n 50</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Liste des 50 derni√®res tentatives √©chou√©es</p>

            <p><strong>Compter les tentatives √©chou√©es :</strong></p>
            <div class="terminal">
<pre>sudo grep 'Failed password' /var/log/auth.log | wc -l</pre>
            </div>
        </section>

        <!-- Exercice 4 -->
        <section id="ex4" class="card">
            <h2 class="glow">üõ°Ô∏è Exercice 4 - Fail2ban</h2>
            
            <h3>4.1 - Cr√©er la configuration locale Fail2ban</h3>
            <div class="terminal">
<pre>sudo tee /etc/fail2ban/jail.d/ssh_local.conf &gt;/dev/null &lt;&lt;'EOF'
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
findtime = 600
bantime = 3600
action = iptables-multiport[name=sshd, port="ssh", protocol="tcp"]
EOF</pre>
            </div>
            <p><strong>Explication de la configuration :</strong></p>
            <ul>
                <li><code>maxretry = 3</code> : 3 tentatives maximum</li>
                <li><code>findtime = 600</code> : sur 10 minutes (600 secondes)</li>
                <li><code>bantime = 3600</code> : bannissement de 1 heure (3600 secondes)</li>
            </ul>

            <h3>4.2 - Red√©marrer Fail2ban</h3>
            <div class="terminal">
<pre>sudo systemctl restart fail2ban</pre>
            </div>
            <p><strong>V√©rifier le statut :</strong></p>
            <div class="terminal">
<pre>sudo systemctl status fail2ban</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> "active (running)"</p>

            <h3>4.3 - V√©rifier la configuration SSH dans Fail2ban</h3>
            <div class="terminal">
<pre>sudo fail2ban-client status sshd</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong></p>
            <div class="terminal">
<pre>Status for the jail: sshd
|- Filter
|  |- Currently failed: 0
|  |- Total failed:     0
|  `- File list:        /var/log/auth.log
`- Actions
   |- Currently banned: 0
   |- Total banned:     0
   `- Banned IP list:</pre>
            </div>

            <h3>4.4 - Tester l'attaque Hydra avec Fail2ban actif</h3>
            <div class="terminal">
<pre>hydra -l alice -P ~/wordlist_course.txt ssh://127.0.0.1 -t 4</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Apr√®s 3 tentatives, Hydra sera bloqu√© par Fail2ban</p>

            <h3>4.5 - V√©rifier que l'IP est bannie</h3>
            <div class="terminal">
<pre>sudo fail2ban-client status sshd</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> 127.0.0.1 devrait appara√Ætre dans "Banned IP list"</p>

            <p><strong>Voir les d√©tails du bannissement :</strong></p>
            <div class="terminal">
<pre>sudo fail2ban-client get sshd banip</pre>
            </div>

            <h3>4.6 - D√©bannir l'IP (si n√©cessaire)</h3>
            <div class="terminal">
<pre>sudo fail2ban-client set sshd unbanip 127.0.0.1</pre>
            </div>
        </section>

        <!-- Exercice 5 -->
        <section id="ex5" class="card">
            <h2 class="glow">üîë Exercice 5 - Authentification par cl√© SSH</h2>
            
            <h3>5.1 - G√©n√©rer une paire de cl√©s SSH</h3>
            <div class="terminal">
<pre>ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519_course -N ""</pre>
            </div>
            <p><strong>Explication des param√®tres :</strong></p>
            <ul>
                <li><code>-t ed25519</code> : algorithme moderne et s√©curis√©</li>
                <li><code>-f ~/.ssh/id_ed25519_course</code> : nom du fichier</li>
                <li><code>-N ""</code> : pas de phrase de passe (pour le TP uniquement)</li>
            </ul>
            <p><strong>R√©sultat attendu :</strong> 2 fichiers cr√©√©s</p>
            <ul>
                <li><code>~/.ssh/id_ed25519_course</code> (cl√© priv√©e)</li>
                <li><code>~/.ssh/id_ed25519_course.pub</code> (cl√© publique)</li>
            </ul>

            <h3>5.2 - V√©rifier les cl√©s g√©n√©r√©es</h3>
            <div class="terminal">
<pre>ls -l ~/.ssh/id_ed25519_course*</pre>
            </div>

            <h3>5.3 - Installer la cl√© publique pour Bob</h3>
            <p><strong>Cr√©er le r√©pertoire .ssh pour Bob :</strong></p>
            <div class="terminal">
<pre>sudo mkdir -p /home/bob/.ssh</pre>
            </div>

            <p><strong>Copier la cl√© publique :</strong></p>
            <div class="terminal">
<pre>sudo cp ~/.ssh/id_ed25519_course.pub /home/bob/.ssh/authorized_keys</pre>
            </div>

            <p><strong>D√©finir les bonnes permissions :</strong></p>
            <div class="terminal">
<pre>sudo chown -R bob:bob /home/bob/.ssh
sudo chmod 700 /home/bob/.ssh
sudo chmod 600 /home/bob/.ssh/authorized_keys</pre>
            </div>
            <p><strong>Explication des permissions :</strong></p>
            <ul>
                <li><code>700</code> sur <code>.ssh</code> : seul Bob peut lire/√©crire/ex√©cuter</li>
                <li><code>600</code> sur <code>authorized_keys</code> : seul Bob peut lire/√©crire</li>
            </ul>

            <h3>5.4 - D√©sactiver l'authentification par mot de passe</h3>
            <div class="terminal">
<pre>sudo sed -i 's/^PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config</pre>
            </div>

            <p><strong>V√©rifier la modification :</strong></p>
            <div class="terminal">
<pre>sudo grep "PasswordAuthentication" /etc/ssh/sshd_config</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> <code>PasswordAuthentication no</code></p>

            <p><strong>Red√©marrer SSH :</strong></p>
            <div class="terminal">
<pre>sudo systemctl restart ssh</pre>
            </div>

            <h3>5.5 - Tester la connexion par cl√©</h3>
            <div class="terminal">
<pre>ssh -i ~/.ssh/id_ed25519_course bob@127.0.0.1</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Connexion r√©ussie sans demande de mot de passe</p>

            <p><strong>Se d√©connecter :</strong></p>
            <div class="terminal">
<pre>exit</pre>
            </div>

            <h3>5.6 - V√©rifier qu'Hydra √©choue maintenant</h3>
            <div class="terminal">
<pre>hydra -l bob -P ~/wordlist_course.txt ssh://127.0.0.1 -t 4</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Hydra ne peut plus se connecter car l'authentification par mot de passe est d√©sactiv√©e</p>
        </section>

        <!-- Restauration -->
        <section id="restore" class="card">
            <h2 class="glow">üîÑ Restauration du syst√®me</h2>
            
            <h3>R.1 - R√©activer l'authentification par mot de passe</h3>
            <div class="terminal">
<pre>sudo sed -i 's/^PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config</pre>
            </div>

            <p><strong>Red√©marrer SSH :</strong></p>
            <div class="terminal">
<pre>sudo systemctl restart ssh</pre>
            </div>

            <h3>R.2 - Supprimer les utilisateurs de test</h3>
            <p><strong>Supprimer Alice :</strong></p>
            <div class="terminal">
<pre>sudo deluser --remove-home alice</pre>
            </div>

            <p><strong>Supprimer Bob :</strong></p>
            <div class="terminal">
<pre>sudo deluser --remove-home bob</pre>
            </div>

            <p><strong>Supprimer Charlie :</strong></p>
            <div class="terminal">
<pre>sudo deluser --remove-home charlie</pre>
            </div>

            <p><strong>V√©rifier la suppression :</strong></p>
            <div class="terminal">
<pre>cat /etc/passwd | grep -E "alice|bob|charlie"</pre>
            </div>
            <p><strong>R√©sultat attendu :</strong> Aucune ligne affich√©e</p>

            <h3>R.3 - Nettoyer les fichiers de test</h3>
            <div class="terminal">
<pre>rm ~/hashes_course.txt
rm ~/wordlist_course.txt
rm ~/.ssh/id_ed25519_course*</pre>
            </div>

            <h3>R.4 - D√©sactiver la configuration Fail2ban personnalis√©e (optionnel)</h3>
            <div class="terminal">
<pre>sudo rm /etc/fail2ban/jail.d/ssh_local.conf
sudo systemctl restart fail2ban</pre>
            </div>
        </section>

        <!-- R√©sum√© -->
        <section class="card">
            <h2 class="glow">üìä R√©sum√© des comp√©tences acquises</h2>
            <h3>‚úÖ Vous avez appris √† :</h3>
            <ol>
                <li>Configurer un environnement de test SSH s√©curis√©</li>
                <li>Extraire et manipuler des hach√©s de mots de passe</li>
                <li>Utiliser John the Ripper pour casser des mots de passe</li>
                <li>Effectuer des attaques brute force avec Hydra</li>
                <li>Prot√©ger SSH avec Fail2ban</li>
                <li>Configurer l'authentification par cl√© SSH</li>
                <li>Analyser les logs de s√©curit√©</li>
            </ol>
        </section>

        <!-- Bonnes pratiques -->
        <section class="card">
            <h2 class="glow">üéì Bonnes pratiques SSH en production</h2>
            <ol>
                <li>Toujours utiliser l'authentification par cl√© SSH</li>
                <li>D√©sactiver l'authentification par mot de passe</li>
                <li>Changer le port SSH par d√©faut (22)</li>
                <li>Utiliser Fail2ban ou des outils similaires</li>
                <li>Limiter les utilisateurs autoris√©s √† se connecter via SSH</li>
                <li>Utiliser des mots de passe forts (20+ caract√®res)</li>
                <li>Activer l'authentification √† deux facteurs (2FA)</li>
                <li>Surveiller r√©guli√®rement les logs</li>
            </ol>
        </section>

        <!-- Ressources -->
        <section class="card">
            <h2 class="glow">üìö Ressources compl√©mentaires</h2>
            <ul>
                <li>Documentation officielle John the Ripper : <a href="https://www.openwall.com/john/" target="_blank">https://www.openwall.com/john/</a></li>
                <li>Documentation Hydra : <a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank">https://github.com/vanhauser-thc/thc-hydra</a></li>
                <li>Guide Fail2ban : <a href="https://www.fail2ban.org/" target="_blank">https://www.fail2ban.org/</a></li>
                <li>S√©curit√© SSH : <a href="https://www.openssh.com/" target="_blank">https://www.openssh.com/</a></li>
            </ul>
        </section>

        <!-- Rappel l√©gal -->
        <section class="card">
            <h2 class="glow">‚öñÔ∏è Rappel l√©gal</h2>
            <p>L'utilisation de ces techniques sur des syst√®mes sans autorisation explicite est <strong>ILL√âGALE</strong> et peut entra√Æner des poursuites judiciaires. Ce TP est √† des fins √©ducatives uniquement dans un environnement contr√¥l√©.</p>
            <p><strong>üéØ Fin du guide - Bon apprentissage !</strong></p>
        </section>
    </div>
</body>
</html>

